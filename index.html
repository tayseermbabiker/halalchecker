<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HalalDetect - Halal Ingredient Scanner</title>
    <meta name="description" content="Scan ingredients for halal compliance with AI-powered analysis">
    <meta name="theme-color" content="#2E7D32">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HalalDetect">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://api.openai.com">
    <script src="config.js" onerror="console.log('Config not loaded, using fallback')"></script>
    
    <style>
        :root {
            --primary-green: #00C851;
            --secondary-green: #00E676;
            --accent-teal: #26C6DA;
            --light-green: #E8F8F5;
            --halal-green: #00E676;
            --suspicious-yellow: #FFD54F;
            --haram-red: #FF5722;
            --background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            --surface: rgba(255, 255, 255, 0.95);
            --card-shadow: rgba(0, 0, 0, 0.15);
            --text-primary: #2C3E50;
            --text-secondary: #7F8C8D;
            --border: rgba(255, 255, 255, 0.2);
            --gradient: linear-gradient(135deg, #00C851 0%, #26C6DA 50%, #00E676 100%);
            --glass-effect: rgba(255, 255, 255, 0.1);
            --backdrop-blur: blur(15px);
        }

        [dir="rtl"] {
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--background);
            z-index: -1;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--gradient);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 100%;
            position: relative;
        }
        
        .scan-counter-bottom {
            text-align: center;
            margin: 1.2rem 0;
        }
        
        .scan-counter-badge {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            min-width: 200px;
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .logo-icon {
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .lang-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .lang-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .main-content {
            flex: 1;
            padding: 1rem;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-section {
            text-align: center;
            padding: 0.8rem 1rem;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            margin-bottom: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .welcome-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px var(--card-shadow);
        }

        .app-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 0.5rem;
            background: var(--gradient);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 8px 25px rgba(0, 200, 81, 0.3);
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-green);
            margin-bottom: 0.5rem;
        }

        .scan-counter {
            background: rgba(0, 200, 81, 0.1);
            color: var(--text-secondary);
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-bottom: 0.3rem;
            display: inline-block;
            border: 1px solid rgba(0, 200, 81, 0.1);
            opacity: 0.8;
        }

        .install-prompt {
            background: rgba(255, 255, 255, 0.95);
            color: var(--primary-green);
            padding: 0.8rem;
            border-radius: 12px;
            margin-bottom: 0.8rem;
            text-align: center;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        .install-prompt.hidden {
            display: none;
        }

        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.3rem;
            min-width: 120px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: 0 8px 25px rgba(0, 200, 81, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 200, 81, 0.5);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            padding: 0.8rem 0;
            margin-bottom: 1rem;
        }

        .camera-section {
            background: var(--surface);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 20px 40px var(--card-shadow);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .camera-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px var(--card-shadow);
        }

        .camera-button {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: var(--gradient);
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 200, 81, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .camera-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .camera-button:hover {
            transform: scale(1.05);
        }

        .camera-button:active {
            transform: scale(0.95);
        }

        .camera-icon {
            font-size: 3rem;
            color: white;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 20px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-bottom: 1rem;
            background: var(--glass-effect);
            backdrop-filter: var(--backdrop-blur);
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,200,81,0.1), transparent);
            transition: left 0.5s;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        .upload-area:hover {
            border-color: var(--primary-green);
            background: var(--light-green);
            transform: scale(1.02);
            box-shadow: 0 10px 30px var(--card-shadow);
        }

        .upload-area.dragover {
            border-color: var(--primary-green);
            background: var(--light-green);
            transform: scale(1.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary-green);
            margin-bottom: 1rem;
        }

        .file-input {
            display: none;
        }

        .manual-input {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .text-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .results-container {
            margin-top: 1rem;
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .results-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .results-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .results-container::-webkit-scrollbar-thumb {
            background: var(--primary-green);
            border-radius: 3px;
        }
        
        .results-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .ingredient-item {
            background: var(--surface);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 15px 35px var(--card-shadow);
            border-left: 4px solid var(--border);
            transition: all 0.4s ease;
            position: relative;
            overflow: visible;
            word-wrap: break-word;
            hyphens: auto;
        }

        .ingredient-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .ingredient-item:hover::before {
            transform: scaleX(1);
        }

        .ingredient-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px var(--card-shadow);
        }

        .ingredient-item.halal {
            border-left-color: var(--halal-green);
        }

        .ingredient-item.suspicious {
            border-left-color: var(--suspicious-yellow);
        }

        .ingredient-item.haram {
            border-left-color: var(--haram-red);
        }

        .ingredient-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .ingredient-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .ingredient-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-halal {
            background: var(--halal-green);
            color: white;
        }

        .status-suspicious {
            background: var(--suspicious-yellow);
            color: white;
        }

        .status-haram {
            background: var(--haram-red);
            color: white;
        }

        .ingredient-explanation {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            line-height: 1.5;
            word-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
        }

        .alternative-links {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .alternative-link {
            background: var(--light-green);
            color: var(--primary-green);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            text-decoration: none;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .alternative-link:hover {
            background: var(--primary-green);
            color: white;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--light-green);
            border-top: 4px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bottom-nav {
            background: var(--surface);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: 20px 20px 0 0;
            padding: 1rem;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -10px 30px var(--card-shadow);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 12px;
            position: relative;
        }

        .nav-item:hover {
            color: var(--primary-green);
            background: var(--glass-effect);
        }

        .nav-item.active {
            color: var(--primary-green);
            background: var(--light-green);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -1rem;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background: var(--primary-green);
            border-radius: 2px;
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .nav-label {
            font-size: 0.8rem;
        }

        .disclaimer {
            background: rgba(255, 255, 255, 0.95);
            padding: 0.6rem;
            border-radius: 12px;
            margin: 0.6rem 0;
            font-size: 0.8rem;
            line-height: 1.4;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .premium-banner {
            background: rgba(255, 255, 255, 0.95);
            color: var(--text-primary);
            padding: 0.8rem;
            border-radius: 12px;
            text-align: center;
            margin: 0.8rem 0;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .premium-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: premium-shine 4s infinite;
        }

        @keyframes premium-shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .premium-banner.hidden {
            display: none;
        }

        .history-item {
            background: var(--surface);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .history-date {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        .history-summary {
            font-weight: 600;
        }

        .settings-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--primary-green);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(26px);
        }

        @media (max-width: 480px) {
            .header-content {
                padding: 0 0.5rem;
            }
            
            .main-content {
                padding: 0.3rem;
            }
            
            .welcome-section {
                padding: 1rem 0.8rem;
                margin-bottom: 0.5rem;
            }
            
            .app-icon {
                width: 50px;
                height: 50px;
                margin: 0 auto 0.3rem;
                font-size: 1.2rem;
            }
            
            .app-title {
                font-size: 1.3rem;
                margin-bottom: 0.3rem;
            }
            
            .scan-counter {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
                margin-bottom: 0.3rem;
            }
            
            .install-prompt {
                padding: 1.2rem;
                margin-bottom: 1rem;
                font-size: 0.9rem;
            }
            
            .install-prompt .btn {
                margin: 0.15rem;
                padding: 0.5rem 0.8rem;
                font-size: 0.75rem;
                min-width: 100px;
                min-height: 36px;
                border-radius: 8px;
            }
            
            .install-prompt .btn-secondary:first-of-type {
                background: var(--primary-green);
                color: white;
                border: none;
            }
            
            .install-prompt .btn-secondary:last-of-type {
                background: transparent;
                color: var(--primary-green);
                border: 1px solid var(--primary-green);
            }
            
            .action-buttons {
                gap: 0.5rem;
                padding: 0.3rem 0;
            }
            
            .btn {
                padding: 0.7rem 1.2rem;
                font-size: 0.85rem;
                margin: 0.2rem;
                min-width: 100px;
            }
            
            .disclaimer {
                padding: 0.6rem;
                font-size: 0.75rem;
                margin: 0.3rem 0;
                line-height: 1.3;
            }
            
            .camera-button {
                width: 100px;
                height: 100px;
            }
            
            
            /* Ensure everything fits in viewport */
            .app-container {
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }
            
            .main-content {
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }
            
            /* Compact home screen layout */
            #home-screen {
                display: flex;
                flex-direction: column;
                min-height: calc(100vh - 120px); /* Account for header and bottom nav */
                justify-content: space-evenly;
                padding: 1rem 0;
            }
            
            /* Create visual sections */
            .mobile-section {
                margin-bottom: 0.8rem;
            }
            
            /* Consistent card styling */
            .mobile-card {
                background: var(--surface);
                backdrop-filter: var(--backdrop-blur);
                border: 1px solid var(--border);
                border-radius: 16px;
                box-shadow: 0 8px 24px var(--card-shadow);
                margin-bottom: 0.8rem;
                transition: all 0.3s ease;
            }
            
            /* Primary action button styling */
            .primary-action-section {
                text-align: center;
                margin-bottom: 1rem;
            }
            
            .primary-action-section .btn-primary {
                width: 85%;
                max-width: 320px;
                padding: 1.2rem 1.5rem;
                font-size: 1.1rem;
                font-weight: 600;
                border-radius: 16px;
                min-height: 58px;
                display: inline-block;
                text-align: center;
                box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
                transition: all 0.3s ease;
            }
            
            .primary-action-section .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
            }
            
            .camera-icon {
                font-size: 1.4rem;
                animation: cameraFloat 2s ease-in-out infinite;
                display: inline-block;
                transition: all 0.3s ease;
            }
            
            .primary-action-section .btn-primary:hover .camera-icon {
                animation: cameraShake 0.5s ease-in-out;
                transform: scale(1.1);
            }
            
            @keyframes cameraFloat {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-4px); }
            }
            
            @keyframes cameraShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-2px) rotate(-5deg); }
                75% { transform: translateX(2px) rotate(5deg); }
            }
            
            .secondary-action-section {
                text-align: center;
                margin-bottom: 1rem;
            }

            .secondary-action-section .btn-secondary {
                width: 85%;
                max-width: 320px;
                padding: 0.8rem 1.2rem;
                font-size: 0.95rem;
                border-radius: 12px;
                min-height: 48px;
                background: rgba(255, 255, 255, 0.9);
                color: var(--text-primary);
                border: 1px solid rgba(255, 255, 255, 0.3);
                display: inline-block;
                text-align: center;
            }
            
            .bottom-nav {
                padding: 0.8rem;
            }
            
            .nav-label {
                font-size: 0.7rem;
            }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #c62828;
        }

        .success-message {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #2e7d32;
        }

        .hidden {
            display: none !important;
        }

        /* Legal Pages Styles */
        .legal-links {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .legal-links h3 {
            color: var(--text-primary);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .legal-item {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .legal-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .arrow {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .legal-content {
            padding: 2rem;
            max-width: 100%;
            overflow-y: auto;
        }

        .legal-content h2 {
            color: var(--primary-green);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .legal-content h3 {
            color: var(--text-primary);
            margin: 1.5rem 0 0.8rem 0;
        }

        .content-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow);
        }

        .content-section p, .content-section li {
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .content-section ul {
            padding-left: 1.2rem;
        }

        .contact-info {
            background: var(--light-green);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .contact-detail {
            font-size: 1.1rem;
        }

        .contact-detail a {
            color: var(--primary-green);
            text-decoration: none;
            font-weight: 600;
        }

        .contact-form {
            margin: 1.5rem 0;
        }

        .back-btn {
            width: auto;
            padding: 0.8rem 1.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">H</span>
                    <span data-translate="app-name">HalalDetect</span>
                </div>
                <button class="lang-toggle" onclick="toggleLanguage()">
                    <span id="lang-text">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- Home Screen -->
            <div id="home-screen" class="screen active">
                <div class="install-prompt" id="install-prompt">
                    <div><span data-translate="install-tip">Add this to your home screen for quick access!</span></div>
                    <div style="margin-top: 0.5rem;">
                        <button class="btn btn-secondary" onclick="installApp()" data-translate="install-now">Install Now</button>
                        <button class="btn btn-secondary" onclick="dismissInstallPrompt()" data-translate="maybe-later">Maybe Later</button>
                    </div>
                </div>



                <!-- Primary Actions Section -->
                <div class="primary-action-section">
                    <button class="btn btn-primary" onclick="showScreen('camera-screen')" data-translate="scan-ingredients">
                        <span class="camera-icon">üì∑</span>Scan Ingredients
                    </button>
                </div>

                <!-- Secondary Actions Section -->
                <div class="secondary-action-section">
                    <button class="btn btn-secondary" onclick="showScreen('manual-screen')" data-translate="manual-input">Manual Input</button>
                </div>

                <!-- Scan Counter (under Manual Input) -->
                <div class="scan-counter-bottom">
                    <div class="scan-counter-badge" id="scan-counter-badge">
                        <span data-translate="scans-remaining">5/5 free</span>
                    </div>
                </div>

                <!-- Premium Banner (after scan counter) -->
                <div class="premium-banner" id="premium-banner">
                    <div data-translate="upgrade-premium">For Unlimited Scans</div>
                    <button class="btn btn-primary" onclick="upgradeToPremium()" data-translate="get-premium" style="width: 75%; max-width: 280px; padding: 0.8rem 1rem; font-size: 0.9rem;">Get Premium - $4.99/month</button>
                </div>

                <!-- Disclaimer Section (pushed down) -->
                <div class="disclaimer" style="margin-top: 1.5rem;">
                    <p data-translate="disclaimer">
                        This tool provides ingredient analysis based on Islamic dietary guidelines for informational purposes. For specific religious guidance or complex cases, please consult with a qualified Islamic scholar or halal certification authority.
                    </p>
                </div>
            </div>

            <!-- Camera/Upload Screen -->
            <div id="camera-screen" class="screen">
                <div class="camera-section">
                    <h2 data-translate="scan-title">Scan Ingredient List</h2>
                    <div class="camera-button" onclick="document.getElementById('file-input').click()">
                        <div class="camera-icon">‚óâ</div>
                    </div>
                    <input type="file" id="file-input" class="file-input" accept="image/*" onchange="handleImageUpload(event)">
                    <p data-translate="camera-instruction">Tap to take photo or upload image</p>
                </div>

                <div class="upload-area" onclick="document.getElementById('file-input').click()" 
                     ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">‚¨Ü</div>
                    <p data-translate="upload-instruction">Drop image here or click to upload</p>
                </div>
            </div>

            <!-- Manual Input Screen -->
            <div id="manual-screen" class="screen">
                <div class="manual-input">
                    <h2 data-translate="manual-title">Enter Ingredients Manually</h2>
                    <textarea class="text-input" id="manual-ingredients" 
                              placeholder="Enter one ingredient (e.g. gelatin, lecithin, vanilla)..." 
                              data-translate-placeholder="manual-placeholder"></textarea>
                    <button class="btn btn-primary" onclick="analyzeManualIngredients()" data-translate="analyze-btn">Analyze Ingredients</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="screen">
                <div class="results-container" id="results-container">
                    <!-- Results will be populated here -->
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="shareResults()" data-translate="share-results">üì± Share Results</button>
                    <button class="btn btn-secondary" onclick="showScreen('home-screen')" data-translate="scan-another">üîÑ Scan Another</button>
                </div>
            </div>

            <!-- Loading Screen -->
            <div id="loading-screen" class="screen">
                <div class="loading">
                    <div class="spinner"></div>
                    <p data-translate="analyzing">Analyzing ingredients...</p>
                </div>
            </div>

            <!-- History Screen -->
            <div id="history-screen" class="screen">
                <h2 data-translate="scan-history">Scan History</h2>
                <div id="history-list">
                    <!-- History items will be populated here -->
                </div>
            </div>

            <!-- Settings Screen -->
            <div id="settings-screen" class="screen">
                <div class="settings-section">
                    <h2 data-translate="settings-title">Settings</h2>
                    <div class="setting-item">
                        <span data-translate="notifications">Notifications</span>
                        <div class="toggle-switch" onclick="toggleSetting('notifications')"></div>
                    </div>
                    <div class="setting-item">
                        <span data-translate="business-features">Business Features</span>
                        <div class="toggle-switch" onclick="toggleBusinessFeatures()"></div>
                    </div>
                    <div class="setting-item">
                        <span data-translate="community-sharing">Community Sharing</span>
                        <div class="toggle-switch" onclick="toggleSetting('sharing')"></div>
                    </div>
                    
                    <div class="legal-links">
                        <h3 data-translate="legal-section">Legal</h3>
                        <div class="setting-item legal-item" onclick="showScreen('about-screen')">
                            <span data-translate="about-us">About Us</span>
                            <span class="arrow">‚Ä∫</span>
                        </div>
                        <div class="setting-item legal-item" onclick="showScreen('terms-screen')">
                            <span data-translate="terms-service">Terms of Service</span>
                            <span class="arrow">‚Ä∫</span>
                        </div>
                        <div class="setting-item legal-item" onclick="showScreen('privacy-screen')">
                            <span data-translate="privacy-policy">Privacy Policy</span>
                            <span class="arrow">‚Ä∫</span>
                        </div>
                        <div class="setting-item legal-item" onclick="showScreen('contact-screen')">
                            <span data-translate="contact-us">Contact Us</span>
                            <span class="arrow">‚Ä∫</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- About Us Screen -->
            <div id="about-screen" class="screen">
                <div class="legal-content">
                    <h2 data-translate="about-us">About Us</h2>
                    <div class="content-section">
                        <p data-translate="about-intro">HalalDetect is an AI-powered halal ingredient checker designed to help Muslims make informed dietary choices with confidence.</p>
                        
                        <h3 data-translate="our-mission">Our Mission</h3>
                        <p data-translate="mission-text">To provide accurate, reliable halal ingredient verification using advanced artificial intelligence, respecting all schools of Islamic jurisprudence.</p>
                        
                        <h3 data-translate="features">Key Features</h3>
                        <ul>
                            <li data-translate="feature-ai">AI-powered ingredient analysis</li>
                            <li data-translate="feature-multilingual">Bilingual support (Arabic & English)</li>
                            <li data-translate="feature-schools">Consideration of different Islamic schools</li>
                            <li data-translate="feature-offline">Offline capability</li>
                        </ul>
                        
                        <h3 data-translate="disclaimer-title">Important Disclaimer</h3>
                        <p data-translate="disclaimer-full">This tool provides ingredient analysis for informational purposes only. For definitive rulings on complex cases or specific religious guidance, please consult with qualified Islamic scholars or halal certification authorities.</p>
                    </div>
                    <button class="btn btn-secondary back-btn" onclick="showScreen('settings-screen')" data-translate="back">‚Üê Back</button>
                </div>
            </div>

            <!-- Terms of Service Screen -->
            <div id="terms-screen" class="screen">
                <div class="legal-content">
                    <h2 data-translate="terms-service">Terms of Service</h2>
                    <div class="content-section">
                        <p><strong data-translate="effective-date">Effective Date:</strong> <span data-translate="current-date">January 2025</span></p>
                        
                        <h3 data-translate="acceptance">1. Acceptance of Terms</h3>
                        <p data-translate="acceptance-text">By using HalalDetect, you agree to these Terms of Service and acknowledge that the app provides informational guidance only.</p>
                        
                        <h3 data-translate="service-description">2. Service Description</h3>
                        <p data-translate="service-text">HalalDetect analyzes ingredients using AI technology to provide halal/haram classifications based on Islamic dietary guidelines.</p>
                        
                        <h3 data-translate="user-responsibilities">3. User Responsibilities</h3>
                        <p data-translate="responsibilities-text">Users are responsible for verifying results with qualified Islamic authorities for important dietary decisions.</p>
                        
                        <h3 data-translate="limitations">4. Limitations</h3>
                        <p data-translate="limitations-text">Results are for informational purposes only. HalalDetect is not liable for dietary decisions based on app results.</p>
                        
                        <h3 data-translate="contact-terms">5. Contact</h3>
                        <p data-translate="contact-terms-text">For questions about these terms, contact us at: Eterna.eneral@gmail.com</p>
                    </div>
                    <button class="btn btn-secondary back-btn" onclick="showScreen('settings-screen')" data-translate="back">‚Üê Back</button>
                </div>
            </div>

            <!-- Privacy Policy Screen -->
            <div id="privacy-screen" class="screen">
                <div class="legal-content">
                    <h2 data-translate="privacy-policy">Privacy Policy</h2>
                    <div class="content-section">
                        <p><strong data-translate="effective-date">Effective Date:</strong> <span data-translate="current-date">January 2025</span></p>
                        
                        <h3 data-translate="info-collection">1. Information We Collect</h3>
                        <p data-translate="collection-text">We collect uploaded images, ingredient lists, and usage statistics to improve our service. All data is processed locally when possible.</p>
                        
                        <h3 data-translate="info-use">2. How We Use Your Information</h3>
                        <ul>
                            <li data-translate="use-analysis">Ingredient analysis and halal verification</li>
                            <li data-translate="use-improvement">Service improvement and feature development</li>
                            <li data-translate="use-support">Customer support and technical assistance</li>
                        </ul>
                        
                        <h3 data-translate="data-sharing">3. Data Sharing</h3>
                        <p data-translate="sharing-text">We do not sell personal data. We may share anonymized data to improve AI models and only share personal data when required by law.</p>
                        
                        <h3 data-translate="data-security">4. Data Security</h3>
                        <p data-translate="security-text">We implement industry-standard security measures to protect your data, including encryption and secure storage.</p>
                        
                        <h3 data-translate="user-rights">5. Your Rights</h3>
                        <p data-translate="rights-text">You can request data deletion, access your data, or opt-out of data collection by contacting us.</p>
                        
                        <h3 data-translate="contact-privacy">6. Contact Us</h3>
                        <p data-translate="contact-privacy-text">For privacy concerns, email us at: Eterna.eneral@gmail.com</p>
                    </div>
                    <button class="btn btn-secondary back-btn" onclick="showScreen('settings-screen')" data-translate="back">‚Üê Back</button>
                </div>
            </div>

            <!-- Contact Us Screen -->
            <div id="contact-screen" class="screen">
                <div class="legal-content">
                    <h2 data-translate="contact-us">Contact Us</h2>
                    <div class="content-section">
                        <p data-translate="contact-intro">We'd love to hear from you! Get in touch with any questions, suggestions, or feedback.</p>
                        
                        <div class="contact-info">
                            <h3 data-translate="email-support">Email Support</h3>
                            <p class="contact-detail">
                                <strong>Email:</strong> <a href="mailto:Eterna.eneral@gmail.com">Eterna.eneral@gmail.com</a>
                            </p>
                            <p data-translate="response-time">We typically respond within 24-48 hours.</p>
                        </div>
                        
                        <div class="contact-form">
                            <h3 data-translate="send-message">Send us a Message</h3>
                            <textarea class="text-input" id="contact-message" placeholder="Your message..." data-translate-placeholder="contact-placeholder"></textarea>
                            <button class="btn btn-primary" onclick="sendContactMessage()" data-translate="send">Send Message</button>
                        </div>
                        
                        <div class="contact-info">
                            <h3 data-translate="report-issue">Report an Issue</h3>
                            <p data-translate="issue-text">Found an incorrect halal classification? Please let us know so we can improve our AI model.</p>
                        </div>
                        
                        <div class="contact-info">
                            <h3 data-translate="business-inquiries">Business Inquiries</h3>
                            <p data-translate="business-text">Interested in enterprise features or partnerships? Contact us at the email above.</p>
                        </div>
                    </div>
                    <button class="btn btn-secondary back-btn" onclick="showScreen('settings-screen')" data-translate="back">‚Üê Back</button>
                </div>
            </div>
        </main>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="showScreen('home-screen')">
                <div class="nav-icon">‚åÇ</div>
                <div class="nav-label" data-translate="nav-home">Home</div>
            </div>
            <div class="nav-item" onclick="showScreen('history-screen')">
                <div class="nav-icon">‚ñ§</div>
                <div class="nav-label" data-translate="nav-history">History</div>
            </div>
            <div class="nav-item" onclick="showScreen('settings-screen')">
                <div class="nav-icon">‚öô</div>
                <div class="nav-label" data-translate="nav-settings">Settings</div>
            </div>
        </nav>
    </div>

    <script>
        // Global variables
        let currentLanguage = 'en';
        let dailyScans = 0;
        let maxFreeScans = 5;
        let isPremium = false;
        let scanHistory = [];
        let deferredPrompt = null;

        // Translation data
        const translations = {
            en: {
                'app-name': 'HalalDetect',
                'app-title': 'HalalDetect',
                'scans-remaining': '5/5 free',
                'install-tip': 'Add this to your home screen for quick access!',
                'install-now': 'Install Now',
                'maybe-later': 'Maybe Later',
                'upgrade-premium': 'For Unlimited Scans',
                'unlimited-scans': 'Unlimited scans',
                'business-tools': 'Business tools',
                'priority-support': 'Priority support',
                'get-premium': 'Get Premium - $4.99/month',
                'continue-free': 'Continue Free',
                'scan-ingredients': '<span class="camera-icon">üì∑</span>Scan Ingredients',
                'manual-input': 'Manual Input',
                'disclaimer': 'This tool provides ingredient analysis based on Islamic dietary guidelines for informational purposes. For specific religious guidance or complex cases, please consult with a qualified Islamic scholar or halal certification authority.',
                'scan-title': 'Scan Ingredient List',
                'camera-instruction': 'Tap to scan ingredient list, barcode, or upload image',
                'upload-instruction': 'Drop ingredient list/barcode image here or click to upload',
                'manual-title': 'Enter Ingredients Manually',
                'manual-placeholder': 'Enter one ingredient (e.g. gelatin, lecithin, vanilla)...',
                'analyze-btn': 'Analyze Ingredients',
                'share-results': 'Share Results',
                'scan-another': 'Scan Another',
                'analyzing': 'Analyzing ingredients...',
                'scan-history': 'Scan History',
                'settings-title': 'Settings',
                'notifications': 'Notifications',
                'business-features': 'Business Features',
                'community-sharing': 'Community Sharing',
                'nav-home': 'Home',
                'nav-history': 'History',
                'nav-settings': 'Settings',
                'legal-section': 'Legal',
                'about-us': 'About Us',
                'terms-service': 'Terms of Service',
                'privacy-policy': 'Privacy Policy',
                'contact-us': 'Contact Us',
                'back': '‚Üê Back',
                'about-intro': 'HalalDetect is an AI-powered halal ingredient checker designed to help Muslims make informed dietary choices with confidence.',
                'our-mission': 'Our Mission',
                'mission-text': 'To provide accurate, reliable halal ingredient verification using advanced artificial intelligence, respecting all schools of Islamic jurisprudence.',
                'features': 'Key Features',
                'feature-ai': 'AI-powered ingredient analysis',
                'feature-multilingual': 'Bilingual support (Arabic & English)',
                'feature-schools': 'Consideration of different Islamic schools',
                'feature-offline': 'Offline capability',
                'disclaimer-title': 'Important Disclaimer',
                'disclaimer-full': 'This tool provides ingredient analysis for informational purposes only. For definitive rulings on complex cases or specific religious guidance, please consult with qualified Islamic scholars or halal certification authorities.',
                'effective-date': 'Effective Date:',
                'current-date': 'January 2025',
                'acceptance': '1. Acceptance of Terms',
                'acceptance-text': 'By using HalalDetect, you agree to these Terms of Service and acknowledge that the app provides informational guidance only.',
                'service-description': '2. Service Description',
                'service-text': 'HalalDetect analyzes ingredients using AI technology to provide halal/haram classifications based on Islamic dietary guidelines.',
                'user-responsibilities': '3. User Responsibilities',
                'responsibilities-text': 'Users are responsible for verifying results with qualified Islamic authorities for important dietary decisions.',
                'limitations': '4. Limitations',
                'limitations-text': 'Results are for informational purposes only. HalalDetect is not liable for dietary decisions based on app results.',
                'contact-terms': '5. Contact',
                'contact-terms-text': 'For questions about these terms, contact us at: Eterna.eneral@gmail.com',
                'info-collection': '1. Information We Collect',
                'collection-text': 'We collect uploaded images, ingredient lists, and usage statistics to improve our service. All data is processed locally when possible.',
                'info-use': '2. How We Use Your Information',
                'use-analysis': 'Ingredient analysis and halal verification',
                'use-improvement': 'Service improvement and feature development',
                'use-support': 'Customer support and technical assistance',
                'data-sharing': '3. Data Sharing',
                'sharing-text': 'We do not sell personal data. We may share anonymized data to improve AI models and only share personal data when required by law.',
                'data-security': '4. Data Security',
                'security-text': 'We implement industry-standard security measures to protect your data, including encryption and secure storage.',
                'user-rights': '5. Your Rights',
                'rights-text': 'You can request data deletion, access your data, or opt-out of data collection by contacting us.',
                'contact-privacy': '6. Contact Us',
                'contact-privacy-text': 'For privacy concerns, email us at: Eterna.eneral@gmail.com',
                'contact-intro': 'We\'d love to hear from you! Get in touch with any questions, suggestions, or feedback.',
                'email-support': 'Email Support',
                'response-time': 'We typically respond within 24-48 hours.',
                'send-message': 'Send us a Message',
                'contact-placeholder': 'Your message...',
                'send': 'Send Message',
                'report-issue': 'Report an Issue',
                'issue-text': 'Found an incorrect halal classification? Please let us know so we can improve our AI model.',
                'business-inquiries': 'Business Inquiries',
                'business-text': 'Interested in enterprise features or partnerships? Contact us at the email above.'
            },
            ar: {
                'app-name': 'ŸÉÿßÿ¥ŸÅ ÿßŸÑÿ≠ŸÑÿßŸÑ',
                'app-title': 'ŸÉÿßÿ¥ŸÅ ÿßŸÑÿ≠ŸÑÿßŸÑ',
                'scans-remaining': '5/5 ŸÖÿ¨ÿßŸÜŸä',
                'install-tip': 'ÿ£ÿ∂ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ•ŸÑŸâ ÿ¥ÿßÿ¥ÿ™ŸÉ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ!',
                'install-now': 'üì≤ ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ¢ŸÜ',
                'maybe-later': 'ÿ±ÿ®ŸÖÿß ŸÑÿßÿ≠ŸÇÿßŸã',
                'upgrade-premium': 'ŸÑŸÑŸÅÿ≠Ÿàÿµÿßÿ™ ÿßŸÑŸÑÿß ŸÖÿ≠ÿØŸàÿØÿ©',
                'unlimited-scans': 'ŸÅÿ≠Ÿàÿµÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ÿØŸàÿØÿ©',
                'business-tools': 'ÿ£ÿØŸàÿßÿ™ ÿßŸÑÿ£ÿπŸÖÿßŸÑ',
                'priority-support': 'ÿØÿπŸÖ ŸÖŸÖŸäÿ≤',
                'get-premium': 'ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑŸÖŸÖŸäÿ≤ - 4.99$ ÿ¥Ÿáÿ±ŸäÿßŸã',
                'continue-free': 'ŸÖÿ™ÿßÿ®ÿπÿ© ŸÖÿ¨ÿßŸÜÿßŸã',
                'scan-ingredients': '<span class="camera-icon">üì∑</span>ŸÅÿ≠ÿµ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™',
                'manual-input': '‚úçÔ∏è ÿ•ÿØÿÆÿßŸÑ ŸäÿØŸàŸä',
                'disclaimer': 'ÿ™ŸàŸÅÿ± Ÿáÿ∞Ÿá ÿßŸÑÿ£ÿØÿßÿ© ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ•ÿ±ÿ¥ÿßÿØÿßÿ™ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ© ŸÑÿ£ÿ∫ÿ±ÿßÿ∂ ÿ•ÿπŸÑÿßŸÖŸäÿ©. ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿ±ÿ¥ÿßÿØÿßÿ™ ÿØŸäŸÜŸäÿ© ŸÖÿ≠ÿØÿØÿ© ÿ£Ÿà ÿ≠ÿßŸÑÿßÿ™ ŸÖÿπŸÇÿØÿ©ÿå Ÿäÿ±ÿ¨Ÿâ ÿßÿ≥ÿ™ÿ¥ÿßÿ±ÿ© ÿπÿßŸÑŸÖ ÿ•ÿ≥ŸÑÿßŸÖŸä ŸÖÿ§ŸáŸÑ ÿ£Ÿà ÿ≥ŸÑÿ∑ÿ© ÿßÿπÿ™ŸÖÿßÿØ ÿßŸÑÿ≠ŸÑÿßŸÑ.',
                'scan-title': 'ŸÅÿ≠ÿµ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™',
                'camera-instruction': 'ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÖÿ≥ÿ≠ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿ£Ÿà ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ ÿ£Ÿà ÿ±ŸÅÿπ ÿµŸàÿ±ÿ©',
                'upload-instruction': 'ÿßÿ≥ÿ≠ÿ® ÿµŸàÿ±ÿ© ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™/ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ ŸáŸÜÿß ÿ£Ÿà ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑÿ±ŸÅÿπ',
                'manual-title': 'ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ŸäÿØŸàŸäÿßŸã',
                'manual-placeholder': 'ÿ£ÿØÿÆŸÑ ŸÖŸÉŸàŸÜ Ÿàÿßÿ≠ÿØ (ŸÖÿ´ŸÑ ÿ¨ŸäŸÑÿßÿ™ŸäŸÜÿå ŸÑŸäÿ≥Ÿäÿ´ŸäŸÜ)...',
                'analyze-btn': 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™',
                'share-results': 'üì± ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨',
                'scan-another': 'üîÑ ŸÅÿ≠ÿµ ÿ¢ÿÆÿ±',
                'analyzing': 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™...',
                'scan-history': 'ÿ≥ÿ¨ŸÑ ÿßŸÑŸÅÿ≠Ÿàÿµÿßÿ™',
                'settings-title': 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                'notifications': 'ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™',
                'business-features': 'ŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ£ÿπŸÖÿßŸÑ',
                'community-sharing': 'ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ',
                'nav-home': 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©',
                'nav-history': 'ÿßŸÑÿ≥ÿ¨ŸÑ',
                'nav-settings': 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                'legal-section': 'ŸÇÿßŸÜŸàŸÜŸä',
                'about-us': 'ŸÖŸÜ ŸÜÿ≠ŸÜ',
                'terms-service': 'ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿÆÿØŸÖÿ©',
                'privacy-policy': 'ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿÆÿµŸàÿµŸäÿ©',
                'contact-us': 'ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß',
                'back': '‚Üê ÿ±ÿ¨Ÿàÿπ',
                'about-intro': 'ŸÉÿßÿ¥ŸÅ ÿßŸÑÿ≠ŸÑÿßŸÑ ŸáŸà ÿ™ÿ∑ÿ®ŸäŸÇ ÿ∞ŸÉŸä Ÿäÿ≥ÿßÿπÿØ ÿßŸÑŸÖÿ≥ŸÑŸÖŸäŸÜ ÿπŸÑŸâ ÿßÿ™ÿÆÿßÿ∞ ŸÇÿ±ÿßÿ±ÿßÿ™ ÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ŸÖÿØÿ±Ÿàÿ≥ÿ© ÿ®ÿ´ŸÇÿ©.',
                'our-mission': 'ÿ±ÿ≥ÿßŸÑÿ™ŸÜÿß',
                'mission-text': 'ÿ™ŸàŸÅŸäÿ± ÿ™ÿ≠ŸÇŸÇ ÿØŸÇŸäŸÇ ŸàŸÖŸàÿ´ŸàŸÇ ŸÑŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑÿ≠ŸÑÿßŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿå ŸÖÿπ ÿßÿ≠ÿ™ÿ±ÿßŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ∞ÿßŸáÿ® ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ©.',
                'features': 'ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©',
                'feature-ai': 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä',
                'feature-multilingual': 'ÿØÿπŸÖ ÿ´ŸÜÿßÿ¶Ÿä ÿßŸÑŸÑÿ∫ÿ© (ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ŸàÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©)',
                'feature-schools': 'ŸÖÿ±ÿßÿπÿßÿ© ÿßŸÑŸÖÿ∞ÿßŸáÿ® ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ© ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ©',
                'feature-offline': 'ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿßŸÑÿπŸÖŸÑ ÿØŸàŸÜ ÿßÿ™ÿµÿßŸÑ',
                'disclaimer-title': 'ÿ™ŸÜŸàŸäŸá ŸÖŸáŸÖ',
                'disclaimer-full': 'Ÿáÿ∞ÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸäŸàŸÅÿ± ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ŸÑÿ£ÿ∫ÿ±ÿßÿ∂ ÿ•ÿπŸÑÿßŸÖŸäÿ© ŸÅŸÇÿ∑. ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ÿ≠ŸÉÿßŸÖ ŸÜŸáÿßÿ¶Ÿäÿ© ŸÅŸä ÿßŸÑÿ≠ÿßŸÑÿßÿ™ ÿßŸÑŸÖÿπŸÇÿØÿ© ÿ£Ÿà ŸÑŸÑÿ•ÿ±ÿ¥ÿßÿØ ÿßŸÑÿØŸäŸÜŸä ÿßŸÑŸÖÿ≠ÿØÿØÿå Ÿäÿ±ÿ¨Ÿâ ÿßÿ≥ÿ™ÿ¥ÿßÿ±ÿ© ÿπŸÑŸÖÿßÿ° ÿ•ÿ≥ŸÑÿßŸÖŸäŸäŸÜ ŸÖÿ§ŸáŸÑŸäŸÜ ÿ£Ÿà ÿ≥ŸÑÿ∑ÿßÿ™ ÿßŸÑÿ¥ŸáÿßÿØÿßÿ™ ÿßŸÑÿ≠ŸÑÿßŸÑ.',
                'effective-date': 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ≥ÿ±ŸäÿßŸÜ:',
                'current-date': 'ŸäŸÜÿßŸäÿ± 2025',
                'acceptance': '1. ŸÇÿ®ŸàŸÑ ÿßŸÑÿ¥ÿ±Ÿàÿ∑',
                'acceptance-text': 'ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÉÿßÿ¥ŸÅ ÿßŸÑÿ≠ŸÑÿßŸÑÿå ÿ™ŸàÿßŸÅŸÇ ÿπŸÑŸâ ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿÆÿØŸÖÿ© Ÿáÿ∞Ÿá Ÿàÿ™ŸÇÿ± ÿ®ÿ£ŸÜ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ŸäŸàŸÅÿ± ÿ•ÿ±ÿ¥ÿßÿØÿßÿ™ ÿ•ÿπŸÑÿßŸÖŸäÿ© ŸÅŸÇÿ∑.',
                'service-description': '2. ŸàÿµŸÅ ÿßŸÑÿÆÿØŸÖÿ©',
                'service-text': 'ŸÉÿßÿ¥ŸÅ ÿßŸÑÿ≠ŸÑÿßŸÑ Ÿäÿ≠ŸÑŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ™ŸÇŸÜŸäÿ© ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑÿ™ŸàŸÅŸäÿ± ÿ™ÿµŸÜŸäŸÅÿßÿ™ ÿ≠ŸÑÿßŸÑ/ÿ≠ÿ±ÿßŸÖ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ•ÿ±ÿ¥ÿßÿØÿßÿ™ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ©.',
                'user-responsibilities': '3. ŸÖÿ≥ÿ§ŸàŸÑŸäÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ',
                'responsibilities-text': 'ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ ŸÖÿ≥ÿ§ŸàŸÑŸàŸÜ ÿπŸÜ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÖÿπ ÿßŸÑÿ≥ŸÑÿ∑ÿßÿ™ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ© ÿßŸÑŸÖÿ§ŸáŸÑÿ© ŸÑŸÑŸÇÿ±ÿßÿ±ÿßÿ™ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿßŸÑŸÖŸáŸÖÿ©.',
                'limitations': '4. ÿßŸÑŸÇŸäŸàÿØ',
                'limitations-text': 'ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÑÿ£ÿ∫ÿ±ÿßÿ∂ ÿ•ÿπŸÑÿßŸÖŸäÿ© ŸÅŸÇÿ∑. ŸÉÿßÿ¥ŸÅ ÿßŸÑÿ≠ŸÑÿßŸÑ ÿ∫Ÿäÿ± ŸÖÿ≥ÿ§ŸàŸÑ ÿπŸÜ ÿßŸÑŸÇÿ±ÿßÿ±ÿßÿ™ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ÿßŸÑŸÖÿ®ŸÜŸäÿ© ÿπŸÑŸâ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ.',
                'contact-terms': '5. ÿßŸÑÿ™ŸàÿßÿµŸÑ',
                'contact-terms-text': 'ŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ≠ŸàŸÑ Ÿáÿ∞Ÿá ÿßŸÑÿ¥ÿ±Ÿàÿ∑ÿå ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß ÿπŸÑŸâ: Eterna.eneral@gmail.com',
                'info-collection': '1. ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ™Ÿä ŸÜÿ¨ŸÖÿπŸáÿß',
                'collection-text': 'ŸÜÿ¨ŸÖÿπ ÿßŸÑÿµŸàÿ± ÿßŸÑŸÖÿ±ŸÅŸàÿπÿ© ŸàŸÇŸàÿßÿ¶ŸÖ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ Ÿàÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿÆÿØŸÖÿ™ŸÜÿß. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ŸèÿπÿßŸÑÿ¨ ŸÖÿ≠ŸÑŸäÿßŸã ÿπŸÜÿØ ÿßŸÑÿ•ŸÖŸÉÿßŸÜ.',
                'info-use': '2. ŸÉŸäŸÅ ŸÜÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿπŸÑŸàŸÖÿßÿ™ŸÉ',
                'use-analysis': 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ŸàÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≠ŸÑÿßŸÑ',
                'use-improvement': 'ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿÆÿØŸÖÿ© Ÿàÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÖŸäÿ≤ÿßÿ™',
                'use-support': 'ÿØÿπŸÖ ÿßŸÑÿπŸÖŸÑÿßÿ° ŸàÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™ŸÇŸÜŸäÿ©',
                'data-sharing': '3. ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                'sharing-text': 'ŸÑÿß ŸÜÿ®Ÿäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©. ŸÇÿØ ŸÜÿ¥ÿßÿ±ŸÉ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ¨ŸáŸàŸÑÿ© ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸàŸÜÿ¥ÿßÿ±ŸÉ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ© ŸÅŸÇÿ∑ ÿπŸÜÿØ ÿßŸÑÿ∑ŸÑÿ® ŸÇÿßŸÜŸàŸÜŸäÿßŸã.',
                'data-security': '4. ÿ£ŸÖÿßŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                'security-text': 'ŸÜŸÜŸÅÿ∞ ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿ£ŸÖÿßŸÜ ŸÖÿπŸäÿßÿ±Ÿäÿ© ŸÅŸä ÿßŸÑÿµŸÜÿßÿπÿ© ŸÑÿ≠ŸÖÿßŸäÿ© ÿ®ŸäÿßŸÜÿßÿ™ŸÉÿå ÿ®ŸÖÿß ŸÅŸä ÿ∞ŸÑŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ± ŸàÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ¢ŸÖŸÜ.',
                'user-rights': '5. ÿ≠ŸÇŸàŸÇŸÉ',
                'rights-text': 'ŸäŸÖŸÉŸÜŸÉ ÿ∑ŸÑÿ® ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ£Ÿà ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ŸÉ ÿ£Ÿà ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ ŸÅŸä ÿ¨ŸÖÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß.',
                'contact-privacy': '6. ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß',
                'contact-privacy-text': 'ŸÑŸÖÿÆÿßŸàŸÅ ÿßŸÑÿÆÿµŸàÿµŸäÿ©ÿå ÿ±ÿßÿ≥ŸÑŸÜÿß ÿπŸÑŸâ: Eterna.eneral@gmail.com',
                'contact-intro': 'ŸÜŸàÿØ ÿ≥ŸÖÿßÿπ ÿ¢ÿ±ÿßÿ¶ŸÉŸÖ! ÿ™ŸàÿßÿµŸÑŸàÿß ŸÖÿπŸÜÿß ŸÑÿ£Ÿä ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ£Ÿà ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ÿ£Ÿà ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™.',
                'email-support': 'ÿØÿπŸÖ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä',
                'response-time': 'ŸÜÿ±ÿØ ÿπÿßÿØÿ© ÿÆŸÑÿßŸÑ 24-48 ÿ≥ÿßÿπÿ©.',
                'send-message': 'ÿ£ÿ±ÿ≥ŸÑ ŸÑŸÜÿß ÿ±ÿ≥ÿßŸÑÿ©',
                'contact-placeholder': 'ÿ±ÿ≥ÿßŸÑÿ™ŸÉ...',
                'send': 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©',
                'report-issue': 'ÿßŸÑÿ•ÿ®ŸÑÿßÿ∫ ÿπŸÜ ŸÖÿ¥ŸÉŸÑÿ©',
                'issue-text': 'Ÿàÿ¨ÿØÿ™ ÿ™ÿµŸÜŸäŸÅ ÿ≠ŸÑÿßŸÑ ÿÆÿßÿ∑ÿ¶ÿü ÿ£ÿÆÿ®ÿ±ŸÜÿß ÿ≠ÿ™Ÿâ ŸÜÿ™ŸÖŸÉŸÜ ŸÖŸÜ ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä.',
                'business-inquiries': 'ÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ±ÿßÿ™ ÿßŸÑÿ£ÿπŸÖÿßŸÑ',
                'business-text': 'ŸÖŸáÿ™ŸÖ ÿ®ŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖÿ§ÿ≥ÿ≥ÿßÿ™ ÿ£Ÿà ÿßŸÑÿ¥ÿ±ÿßŸÉÿßÿ™ÿü ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß ÿπŸÑŸâ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ£ÿπŸÑÿßŸá.'
            }
        };

        // Ingredient database for local caching
        const ingredientDatabase = {
            // Common halal ingredients
            'water': { status: 'halal', reason_en: 'Water is naturally permissible', reason_ar: 'ÿßŸÑŸÖÿßÿ° ÿ∑ÿ®ŸäÿπŸä ŸàŸÖÿ≥ŸÖŸàÿ≠' },
            'salt': { status: 'halal', reason_en: 'Salt is naturally permissible', reason_ar: 'ÿßŸÑŸÖŸÑÿ≠ ÿ∑ÿ®ŸäÿπŸä ŸàŸÖÿ≥ŸÖŸàÿ≠' },
            'sugar': { status: 'halal', reason_en: 'Sugar from plants is permissible', reason_ar: 'ÿßŸÑÿ≥ŸÉÿ± ŸÖŸÜ ÿßŸÑŸÜÿ®ÿßÿ™ÿßÿ™ ŸÖÿ≥ŸÖŸàÿ≠' },
            'flour': { status: 'halal', reason_en: 'Wheat flour is plant-based and permissible', reason_ar: 'ÿØŸÇŸäŸÇ ÿßŸÑŸÇŸÖÿ≠ ŸÜÿ®ÿßÿ™Ÿä ŸàŸÖÿ≥ŸÖŸàÿ≠' },
            'rice': { status: 'halal', reason_en: 'Rice is naturally permissible', reason_ar: 'ÿßŸÑÿ£ÿ±ÿ≤ ÿ∑ÿ®ŸäÿπŸä ŸàŸÖÿ≥ŸÖŸàÿ≠' },
            'olive oil': { status: 'halal', reason_en: 'Plant-based oil is permissible', reason_ar: 'ÿßŸÑÿ≤Ÿäÿ™ ÿßŸÑŸÜÿ®ÿßÿ™Ÿä ŸÖÿ≥ŸÖŸàÿ≠' },
            'vegetable oil': { status: 'halal', reason_en: 'Plant-based oil is permissible', reason_ar: 'ÿßŸÑÿ≤Ÿäÿ™ ÿßŸÑŸÜÿ®ÿßÿ™Ÿä ŸÖÿ≥ŸÖŸàÿ≠' },
            
            // Common haram ingredients  
            'pork': { status: 'haram', reason_en: 'Pork is explicitly forbidden in Islam', reason_ar: 'ŸÑÿ≠ŸÖ ÿßŸÑÿÆŸÜÿ≤Ÿäÿ± ŸÖÿ≠ÿ±ŸÖ ÿµÿ±ÿßÿ≠ÿ© ŸÅŸä ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖ' },
            'bacon': { status: 'haram', reason_en: 'Bacon is pork product, forbidden in Islam', reason_ar: 'ÿßŸÑÿ®ŸäŸÉŸàŸÜ ŸÖŸÜ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿÆŸÜÿ≤Ÿäÿ± ÿßŸÑŸÖÿ≠ÿ±ŸÖÿ©' },
            'alcohol': { status: 'haram', reason_en: 'Alcohol is forbidden in Islam', reason_ar: 'ÿßŸÑŸÉÿ≠ŸàŸÑ ŸÖÿ≠ÿ±ŸÖ ŸÅŸä ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖ' },
            'wine': { status: 'haram', reason_en: 'Wine contains alcohol, forbidden in Islam', reason_ar: 'ÿßŸÑŸÜÿ®Ÿäÿ∞ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÉÿ≠ŸàŸÑ ŸÖÿ≠ÿ±ŸÖ' },
            'beer': { status: 'haram', reason_en: 'Beer contains alcohol, forbidden in Islam', reason_ar: 'ÿßŸÑÿ®Ÿäÿ±ÿ© ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÉÿ≠ŸàŸÑ ŸÖÿ≠ÿ±ŸÖ' },
            'lard': { status: 'haram', reason_en: 'Lard is pig fat, forbidden in Islam', reason_ar: 'ÿßŸÑÿ¥ÿ≠ŸÖ ŸáŸà ÿØŸáŸÜ ÿÆŸÜÿ≤Ÿäÿ± ŸÖÿ≠ÿ±ŸÖ' },
            
            // Suspicious ingredients
            'gelatin': { status: 'suspicious', reason_en: 'Gelatin source unknown - could be from pork or beef', reason_ar: 'ŸÖÿµÿØÿ± ÿßŸÑÿ¨ŸäŸÑÿßÿ™ŸäŸÜ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ - ŸÇÿØ ŸäŸÉŸàŸÜ ŸÖŸÜ ÿßŸÑÿÆŸÜÿ≤Ÿäÿ± ÿ£Ÿà ÿßŸÑÿ®ŸÇÿ±' },
            'glycerin': { status: 'suspicious', reason_en: 'Glycerin source unknown - could be animal or plant-based', reason_ar: 'ŸÖÿµÿØÿ± ÿßŸÑÿ¨ŸÑŸäÿ≥ÿ±ŸäŸÜ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ - ŸÇÿØ ŸäŸÉŸàŸÜ ÿ≠ŸäŸàÿßŸÜŸä ÿ£Ÿà ŸÜÿ®ÿßÿ™Ÿä' },
            'mono and diglycerides': { status: 'suspicious', reason_en: 'Source unknown - could be from animal fat', reason_ar: 'ÿßŸÑŸÖÿµÿØÿ± ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ - ŸÇÿØ ŸäŸÉŸàŸÜ ŸÖŸÜ ÿßŸÑÿØŸáŸÜ ÿßŸÑÿ≠ŸäŸàÿßŸÜŸä' },
            'lecithin': { status: 'suspicious', reason_en: 'Usually soy-based but verify source', reason_ar: 'ÿπÿßÿØÿ© ŸÖŸÜ ÿßŸÑÿµŸàŸäÿß ŸàŸÑŸÉŸÜ ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿµÿØÿ±' },
            'vanilla extract': { status: 'suspicious', reason_en: 'May contain alcohol - check if alcohol-free', reason_ar: 'ŸÇÿØ Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÉÿ≠ŸàŸÑ - ÿ™ÿ≠ŸÇŸÇ ÿ•ŸÜ ŸÉÿßŸÜ ÿÆÿßŸÑŸä ŸÖŸÜ ÿßŸÑŸÉÿ≠ŸàŸÑ' }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadUserData();
            updateScanCounter();
            loadHistory();
            setupPWA();
            translatePage();
        }

        function loadUserData() {
            const userData = JSON.parse(localStorage.getItem('halaldetect-user') || '{}');
            dailyScans = userData.dailyScans || 0;
            isPremium = userData.isPremium || false;
            currentLanguage = userData.language || 'en';
            
            // Reset daily scans if new day
            const lastScanDate = userData.lastScanDate || new Date().toDateString();
            if (lastScanDate !== new Date().toDateString()) {
                dailyScans = 0;
            }
            
            // Update language toggle
            document.getElementById('lang-text').textContent = currentLanguage === 'en' ? 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'English';
            document.documentElement.setAttribute('dir', currentLanguage === 'ar' ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', currentLanguage);
            
            // Hide premium banner if user is premium
            if (isPremium) {
                document.getElementById('premium-banner').classList.add('hidden');
            }
        }

        function saveUserData() {
            const userData = {
                dailyScans: dailyScans,
                isPremium: isPremium,
                language: currentLanguage,
                lastScanDate: new Date().toDateString()
            };
            localStorage.setItem('halaldetect-user', JSON.stringify(userData));
        }

        function updateScanCounter() {
            const counter = document.getElementById('scan-counter-badge');
            const remaining = Math.max(0, maxFreeScans - dailyScans);
            const text = isPremium ? 
                (currentLanguage === 'ar' ? 'ŸÖŸÖŸäÿ≤' : 'Premium') :
                (currentLanguage === 'ar' ? `${remaining}/5` : `${remaining}/5 free`);
            counter.querySelector('[data-translate="scans-remaining"]').textContent = text;
        }

        function canScan() {
            return isPremium || dailyScans < maxFreeScans;
        }

        function translatePage() {
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage][key]) {
                    if (key === 'scan-ingredients') {
                        element.innerHTML = translations[currentLanguage][key];
                    } else {
                        element.textContent = translations[currentLanguage][key];
                    }
                }
            });
            
            document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[currentLanguage][key]) {
                    element.setAttribute('placeholder', translations[currentLanguage][key]);
                }
            });
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
            document.getElementById('lang-text').textContent = currentLanguage === 'en' ? 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'English';
            document.documentElement.setAttribute('dir', currentLanguage === 'ar' ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', currentLanguage);
            translatePage();
            updateScanCounter();
            saveUserData();
        }

        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenId).classList.add('active');
            
            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Set active nav item based on screen
            if (screenId === 'home-screen') {
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
            } else if (screenId === 'history-screen') {
                document.querySelector('.nav-item:nth-child(2)').classList.add('active');
                loadHistory();
            } else if (screenId === 'settings-screen') {
                document.querySelector('.nav-item:nth-child(3)').classList.add('active');
            }
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (!canScan()) {
                    showUpgradePrompt();
                    return;
                }
                analyzeImage(file);
            }
        }

        function handleDrop(event) {
            event.preventDefault();
            event.target.classList.remove('dragover');
            const file = event.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                if (!canScan()) {
                    showUpgradePrompt();
                    return;
                }
                analyzeImage(file);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.target.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.target.classList.remove('dragover');
        }

        function analyzeManualIngredients() {
            const ingredientsText = document.getElementById('manual-ingredients').value.trim();
            if (!ingredientsText) {
                showError(currentLanguage === 'ar' ? 'ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÖŸÉŸàŸÜ' : 'Please enter an ingredient');
                return;
            }
            
            // Check for comma or multiple words (indicating multiple ingredients)
            if (ingredientsText.includes(',') || ingredientsText.split(' ').length > 3) {
                showError(currentLanguage === 'ar' ? 
                    'Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÖŸÉŸàŸÜ Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑. ŸÑŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ©ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿµŸàÿ±ÿ© ÿ£Ÿà ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑÿ•ÿµÿØÿßÿ± ÿßŸÑŸÖŸÖŸäÿ≤' : 
                    'Please enter only one ingredient. For multiple ingredients, use image scan or upgrade to premium');
                return;
            }
            
            if (!canScan()) {
                showUpgradePrompt();
                return;
            }
            
            // Process single ingredient
            const ingredients = [ingredientsText];
            analyzeIngredients(ingredients);
        }

        async function analyzeImage(file) {
            showScreen('loading-screen');
            
            try {
                // Convert image to base64
                const base64 = await fileToBase64(file);
                
                // Extract ingredients using OpenAI Vision API
                const ingredients = await extractIngredientsFromImage(base64);
                
                if (ingredients && ingredients.length > 0) {
                    await analyzeIngredients(ingredients);
                } else {
                    showError(currentLanguage === 'ar' ? 
                        'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÖŸÉŸàŸÜÿßÿ™ ŸÅŸä ÿßŸÑÿµŸàÿ±ÿ©' : 
                        'No ingredients found in image');
                    showScreen('camera-screen');
                }
            } catch (error) {
                console.error('Error analyzing image:', error);
                showError(currentLanguage === 'ar' ? 
                    'ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©' : 
                    'Error analyzing image');
                showScreen('camera-screen');
            }
        }

        async function extractIngredientsFromImage(base64Image) {
            // For development: Replace with your API key
            // For production: This will be replaced during Netlify build process
            const OPENAI_API_KEY = window.HALALDETECT_CONFIG?.apiKey || 'YOUR_OPENAI_API_KEY_HERE';
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-4-vision-preview',
                    messages: [{
                        role: 'user',
                        content: [
                            {
                                type: 'text',
                                text: `Analyze this image for halal compliance. This image may contain:
1. INGREDIENT LIST - Extract and analyze ingredients
2. BARCODE - Read the barcode and identify the product, then find ingredient information
3. PRODUCT PACKAGING - Read any visible ingredient information

Read text in ANY language (English, Arabic, Spanish, French, Chinese, etc.) - detect and process whatever language is present.

If you see a BARCODE:
- Identify the barcode number
- State: "I can see a barcode [number] but cannot access real-time product databases. Please scan the ingredient list on the packaging or enter ingredients manually for accurate halal analysis."

If you see an INGREDIENT LIST:
- Extract all ingredients and analyze for halal compliance
- Classify each ingredient as HALAL, SUSPICIOUS, or HARAM

When there are different opinions between Islamic schools of thought, be SPECIFIC about which madhabs hold which positions and their reasoning. For example:

- 'Hanafi scholars consider this haram because...'
- 'Maliki scholars permit this due to...'  
- 'Shafi'i and Hanbali schools agree that...'
- 'There is consensus among all four madhabs that...'

Always cite the specific madhab when mentioning scholarly differences, and explain the Islamic reasoning behind each position. Avoid vague phrases like 'some scholars' or 'some schools of thought' - name the actual madhab and their rationale.

Consider Islamic dietary laws and provide practical guidance for Muslim consumers. Return results as a comma-separated list of ingredients for extraction, then provide detailed analysis.`
                            },
                            {
                                type: 'image_url',
                                image_url: {
                                    url: `data:image/jpeg;base64,${base64Image}`
                                }
                            }
                        ]
                    }],
                    max_tokens: 500
                })
            });

            const result = await response.json();
            const ingredientsText = result.choices[0].message.content;
            return ingredientsText.split(',').map(i => i.trim()).filter(i => i);
        }

        async function analyzeIngredients(ingredients) {
            showScreen('loading-screen');
            
            try {
                const results = [];
                
                // First, check local database for known ingredients
                for (const ingredient of ingredients) {
                    const lowerIngredient = ingredient.toLowerCase();
                    const cached = ingredientDatabase[lowerIngredient];
                    
                    if (cached) {
                        results.push({
                            name: ingredient,
                            status: cached.status,
                            reason_en: cached.reason_en,
                            reason_ar: cached.reason_ar,
                            alternatives: getAlternatives(ingredient, cached.status)
                        });
                    } else {
                        // Use OpenAI API for unknown ingredients
                        const analysis = await analyzeIngredientWithAI(ingredient);
                        results.push(analysis);
                        
                        // Cache the result
                        ingredientDatabase[lowerIngredient] = {
                            status: analysis.status,
                            reason_en: analysis.reason_en,
                            reason_ar: analysis.reason_ar
                        };
                    }
                }
                
                displayResults(results);
                saveToHistory(results);
                
                // Update scan count
                dailyScans++;
                updateScanCounter();
                saveUserData();
                
                showScreen('results-screen');
                
            } catch (error) {
                console.error('Error analyzing ingredients:', error);
                showError(currentLanguage === 'ar' ? 
                    'ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™' : 
                    'Error analyzing ingredients');
                showScreen('home-screen');
            }
        }

        async function analyzeIngredientWithAI(ingredient) {
            // For development: Replace with your API key
            // For production: This will be replaced during Netlify build process
            const OPENAI_API_KEY = window.HALALDETECT_CONFIG?.apiKey || 'YOUR_OPENAI_API_KEY_HERE';
            
            const prompt = `Analyze this ingredient for halal compliance: "${ingredient}". 

Analyze this ingredient for halal compliance. Classify as HALAL, SUSPICIOUS, or HARAM and explain why in simple English. 

When there are different opinions between Islamic schools of thought, be SPECIFIC about which madhabs hold which positions and their reasoning. For example:

- 'Hanafi scholars consider this haram because...'
- 'Maliki scholars permit this due to...'  
- 'Shafi'i and Hanbali schools agree that...'
- 'There is consensus among all four madhabs that...'

Always cite the specific madhab when mentioning scholarly differences, and explain the Islamic reasoning behind each position. Avoid vague phrases like 'some scholars' or 'some schools of thought' - name the actual madhab and their rationale.

Consider Islamic dietary laws and provide practical guidance for Muslim consumers. Provide explanation in both English and Arabic.
            Respond in this JSON format:
            {
                "status": "halal/suspicious/haram",
                "reason_en": "English explanation with scholarly differences noted respectfully",
                "reason_ar": "Arabic explanation"
            }`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 300
                })
            });

            const result = await response.json();
            const analysis = JSON.parse(result.choices[0].message.content);
            
            return {
                name: ingredient,
                status: analysis.status,
                reason_en: analysis.reason_en,
                reason_ar: analysis.reason_ar,
                alternatives: getAlternatives(ingredient, analysis.status)
            };
        }

        function getAlternatives(ingredient, status) {
            if (status === 'halal') return [];
            
            const alternatives = [];
            const lowerIngredient = ingredient.toLowerCase();
            
            if (lowerIngredient.includes('gelatin')) {
                alternatives.push({
                    name: currentLanguage === 'ar' ? 'ÿ¨ŸäŸÑÿßÿ™ŸäŸÜ ÿ≠ŸÑÿßŸÑ' : 'Halal Gelatin',
                    link: 'https://amazon.com/halal-gelatin'
                });
            }
            
            if (lowerIngredient.includes('pork') || lowerIngredient.includes('bacon')) {
                alternatives.push({
                    name: currentLanguage === 'ar' ? 'ŸÑÿ≠ŸÖ ÿ≠ŸÑÿßŸÑ' : 'Halal Meat',
                    link: 'https://zabihah.com'
                });
            }
            
            return alternatives;
        }

        function displayResults(results) {
            const container = document.getElementById('results-container');
            container.innerHTML = '';
            
            results.forEach(result => {
                const item = document.createElement('div');
                item.className = `ingredient-item ${result.status}`;
                
                const reason = currentLanguage === 'ar' ? result.reason_ar : result.reason_en;
                const statusText = result.status.toUpperCase();
                
                item.innerHTML = `
                    <div class="ingredient-header">
                        <div class="ingredient-name">${result.name}</div>
                        <div class="ingredient-status status-${result.status}">${statusText}</div>
                    </div>
                    <div class="ingredient-explanation">${reason}</div>
                    <div class="alternative-links">
                        ${result.alternatives.map(alt => 
                            `<a href="${alt.link}" class="alternative-link" target="_blank">${alt.name}</a>`
                        ).join('')}
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            // Show success message after results
            setTimeout(() => {
                const successMsg = document.createElement('div');
                successMsg.className = 'success-message';
                successMsg.innerHTML = `
                    ‚úÖ ${currentLanguage === 'ar' ? 'ÿ™ŸÖ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!' : 'Ingredients analyzed successfully!'}
                    <br><small>${currentLanguage === 'ar' ? 
                        'ŸáŸÑ ÿ£ÿπÿ¨ÿ®ŸÉ Ÿáÿ∞ÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇÿü ŸÇŸÖ ÿ®ÿ™ÿ´ÿ®Ÿäÿ™Ÿá ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ!' : 
                        'Like this app? Install it for quick access!'}</small>
                `;
                container.insertBefore(successMsg, container.firstChild);
            }, 500);
        }

        function saveToHistory(results) {
            scanHistory.unshift({
                date: new Date().toISOString(),
                results: results,
                summary: `${results.length} ingredients analyzed`
            });
            
            // Keep only last 10 scans
            scanHistory = scanHistory.slice(0, 10);
            localStorage.setItem('halaldetect-history', JSON.stringify(scanHistory));
        }

        function loadHistory() {
            scanHistory = JSON.parse(localStorage.getItem('halaldetect-history') || '[]');
            displayHistory();
        }

        function displayHistory() {
            const container = document.getElementById('history-list');
            container.innerHTML = '';
            
            if (scanHistory.length === 0) {
                container.innerHTML = `<p>${currentLanguage === 'ar' ? 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÅÿ≠Ÿàÿµÿßÿ™ ÿ≥ÿßÿ®ŸÇÿ©' : 'No previous scans'}</p>`;
                return;
            }
            
            scanHistory.forEach((scan, index) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.onclick = () => showHistoryDetails(index);
                
                const date = new Date(scan.date).toLocaleDateString();
                const halalCount = scan.results.filter(r => r.status === 'halal').length;
                const haramCount = scan.results.filter(r => r.status === 'haram').length;
                const suspiciousCount = scan.results.filter(r => r.status === 'suspicious').length;
                
                item.innerHTML = `
                    <div class="history-date">${date}</div>
                    <div class="history-summary">${scan.summary}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">
                        <span style="color: var(--halal-green);">‚úÖ ${halalCount}</span>
                        <span style="color: var(--suspicious-yellow);">‚ö†Ô∏è ${suspiciousCount}</span>
                        <span style="color: var(--haram-red);">‚ùå ${haramCount}</span>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        function showHistoryDetails(index) {
            const scan = scanHistory[index];
            displayResults(scan.results);
            showScreen('results-screen');
        }

        function shareResults() {
            const resultsContainer = document.getElementById('results-container');
            const text = currentLanguage === 'ar' ? 
                'ÿ¥ÿßŸáÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÅÿ≠ÿµ ÿßŸÑÿ≠ŸÑÿßŸÑ ŸÖŸÜ HalalDetect' : 
                'Check out my halal scan results from HalalDetect';
            
            if (navigator.share) {
                navigator.share({
                    title: 'HalalDetect Results',
                    text: text,
                    url: window.location.href
                });
            } else {
                // Fallback to copying to clipboard
                navigator.clipboard.writeText(`${text}\n${window.location.href}`);
                showSuccess(currentLanguage === 'ar' ? 'ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑' : 'Link copied to clipboard');
            }
        }

        function showUpgradePrompt() {
            const message = currentLanguage === 'ar' ? 
                'ŸÑŸÇÿØ ÿßÿ≥ÿ™ŸÜŸÅÿØÿ™ ŸÅÿ≠Ÿàÿµÿßÿ™ŸÉ ÿßŸÑŸÖÿ¨ÿßŸÜŸäÿ© ŸÑŸáÿ∞ÿß ÿßŸÑŸäŸàŸÖ. ŸÇŸÖ ÿ®ÿßŸÑÿ™ÿ±ŸÇŸäÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÅÿ≠Ÿàÿµÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ÿØŸàÿØÿ©!' :
                'You\'ve used all your free scans for today. Upgrade for unlimited scans!';
            
            const upgrade = confirm(message);
            if (upgrade) {
                upgradeToPremium();
            }
        }

        function upgradeToPremium() {
            // In a real app, this would integrate with Stripe or another payment processor
            alert(currentLanguage === 'ar' ? 
                'ŸÖŸäÿ≤ÿ© ÿßŸÑÿØŸÅÿπ ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±. ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØŸÅÿπ ÿßŸÑÿ¢ŸÖŸÜ ŸÇÿ±Ÿäÿ®ÿßŸã!' :
                'Payment feature coming soon! Secure payment integration will be added.');
        }

        function continueFree() {
            document.getElementById('premium-banner').classList.add('hidden');
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        dismissInstallPrompt();
                    }
                });
            } else {
                // Fallback instructions
                alert(currentLanguage === 'ar' ? 
                    'ŸÑÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ•ŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©:\n1. ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©\n2. ÿßÿÆÿ™ÿ± "ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©"' :
                    'To add to home screen:\n1. Tap the share button\n2. Select "Add to Home Screen"');
            }
        }

        function dismissInstallPrompt() {
            document.getElementById('install-prompt').classList.add('hidden');
        }

        function setupPWA() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
            });
            
            window.addEventListener('appinstalled', () => {
                dismissInstallPrompt();
            });
        }

        function toggleSetting(setting) {
            const toggle = event.target;
            toggle.classList.toggle('active');
            
            // Save setting to localStorage
            const settings = JSON.parse(localStorage.getItem('halaldetect-settings') || '{}');
            settings[setting] = toggle.classList.contains('active');
            localStorage.setItem('halaldetect-settings', JSON.stringify(settings));
        }

        function toggleBusinessFeatures() {
            if (!isPremium) {
                showUpgradePrompt();
                return;
            }
            toggleSetting('business');
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.main-content').prepend(errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            document.querySelector('.main-content').prepend(successDiv);
            setTimeout(() => successDiv.remove(), 3000);
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
            });
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        function sendContactMessage() {
            const messageText = document.getElementById('contact-message').value;
            if (!messageText.trim()) {
                showError(currentLanguage === 'ar' ? 'Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ±ÿ≥ÿßŸÑÿ©' : 'Please enter a message');
                return;
            }
            
            // Create mailto link
            const subject = encodeURIComponent('HalalDetect Contact Form');
            const body = encodeURIComponent(messageText);
            const mailtoLink = `mailto:Eterna.eneral@gmail.com?subject=${subject}&body=${body}`;
            
            // Open email client
            window.location.href = mailtoLink;
            
            // Show success message
            showSuccess(currentLanguage === 'ar' ? 'ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä' : 'Email client opened');
            
            // Clear the message
            document.getElementById('contact-message').value = '';
        }
    </script>
</body>
</html>